"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[792],{3112(lt,it,o){var c=o(3686),y=o(7705),n=(o(573),o(7566)),C=o(9819),rt=o(3049),Y=o(4800),v=o(7782),z=o(7293),W=o(6486),N=o(1239),Q=o(5547),mt=o(3806);let l=(()=>{class b{static{this.\u0275fac=function(H){return new(H||b)}}static{this.\u0275cmp=Q.VBU({type:b,selectors:[["demo-root"]],standalone:!1,decls:2,vars:0,template:function(H,At){1&H&&(Q.j41(0,"main"),Q.nrm(1,"router-outlet"),Q.k0s())},dependencies:[mt.n3],styles:["[_nghost-%COMP%]{display:block;font:14px Helvetica Neue,Helvetica,Arial,sans-serif;line-height:1.4em;background:#f5f5f5;color:#4d4d4d;min-width:230px;max-width:550px;margin:0 auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-weight:300}.flex[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]})}}return b})();var $=o(375);const G=[{path:"todos",loadChildren:()=>o.e(139).then(o.bind(o,139)).then(b=>b.TodosModule)},{path:"",redirectTo:"todos",pathMatch:"full"}];let P=(()=>{class b{static{this.\u0275fac=function(H){return new(H||b)}}static{this.\u0275mod=Q.$C({type:b,bootstrap:[l]})}static{this.\u0275inj=$.G2t({providers:[(0,n.mp)()],imports:[c.Bb,C.wb,rt.iI.forRoot(G),Y.yL.forRoot((0,v.gB)({name:"demo",localDocuments:!1,multiInstance:!0,ignoreDuplicate:!1,options:{plugins:[W.uQ,z.Ic,N.g9],storageType:localStorage._ngx_rxdb_storage??"dexie",dumpPath:"assets/data/db.dump.json"}}))]})}}return b})();n.cA.production&&(0,y.SmG)(),c.sG().bootstrapModule(P,{applicationProviders:[(0,y.Jn2)()]}).catch(b=>console.error(b))},4800(lt,it,o){o.d(it,{yL:()=>te,tG:()=>Wt,Qo:()=>wt,rf:()=>kt});var c=o(467),y=o(375),I=o(5547),n=o(1635),C=o(7279),rt=o(8663),Y=o(1277),v=o(1985),z=o(9030),W=o(5558),N=o(3207),Q=o(7673),mt=o(2771),l=o(3726),$=o(7048),G=o(4402),P=o(9568),b=o(6354),ht=o(3294);const{debug:ut,isEmptyObject:H,isFunction:At}=C.lf;function _(i){return function yt(i){return!H(i)&&At(i.run)}(i)?s=>new v.c(t=>s.subscribe(e=>i.run(()=>t.next(e)),e=>i.run(()=>t.error(e)),()=>i.run(()=>t.complete()))):s=>s}function U(){return function(i,s,t){const e=t.value;return t.value=function(...a){return(0,z.v)(()=>this.initialized$.pipe((0,W.n)(()=>e.apply(this,a)),ut(`collection.${s}`)))},t}}function S(){return function(i,s,t){const e=t.value;return t.value=(0,c.A)(function*(...a){return yield(0,N.s)(this.initialized$).catch(()=>{throw new Error(`Collection "${this.config.name}" was not initialized. Please check RxDB errors.`)}),e.apply(this,a)}),t}}var Ct,Dt,Pt,It,Mt,dt;const{getMaybeId:Lt,logger:pt,debug:vt,noop:Tt}=C.lf;let St=(()=>{class i{get initialized$(){return this._init$.asObservable()}get collection(){return this._collection}get db(){return this.dbService.db}get dbOptions(){return this.dbService.dbOptions}get replicationState(){return this._replicationState}get queryParams$(){return this.config.options?.useQueryParams?this.initialized$.pipe((0,W.n)(()=>this.collection.queryParams.$)):(0,Q.of)({})}constructor(t,e,a={},d=(0,Q.of)(""),p=Tt){this.config=t,this.dbService=e,this.ngZone=a,this.currentUrl$=d,this.updateQueryParamsFn=p,this._replicationState=null,this._init$=new mt.m,this.init(t)}close(){this.collection?.close()}setQueryParams(t){this.collection.queryParams?.set(t)}patchQueryParams(t){this.collection.queryParams?.patch(t)}sync(){var t=this;return(0,c.A)(function*(){if((0,C.io)(t.replicationState))t.replicationState.reSync();else if("function"==typeof t.config.options?.replicationStateFactory){try{t._replicationState=t.config.options.replicationStateFactory(t.collection)}catch(e){pt.log("replicationState has error, ignore replication"),pt.log(e.message)}if((0,C.io)(t.replicationState))return t.replicationState.autoStart||t.replicationState.reSync(),(0,l.R)(window,"online").pipe(vt("online"),(0,$.v)(()=>!t.replicationState.isStopped())).subscribe(()=>{t._replicationState.reSync()}),t.replicationState.startPromise}})()}info(){var t=this;return(0,c.A)(function*(){return t.collection.getMetadata()})()}import(t){var e=this;return(0,c.A)(function*(){const a=yield e.collection.schema.hash;e.collection.importJSON({name:e.collection.name,schemaHash:a,docs:t})})()}export(){var t=this;return(0,c.A)(function*(){return t.collection.exportJSON()})()}docs(t,e=!1){return((0,G.A)(t)?t:(0,Q.of)(t)).pipe((0,W.n)(a=>this.collection.find(a).$),(0,C.bB)(e),_(this.ngZone),(0,P.t)(rt.bz))}docsByIds(t,e=!1){return this.collection.findByIds(t).$.pipe((0,C.bB)(e),_(this.ngZone),(0,P.t)(rt.bz))}count(t){return this.collection.count(t).$.pipe(_(this.ngZone),(0,P.t)(rt.bz))}get(t,e=!1){return this.collection.findOne(t).$.pipe((0,b.T)(a=>a?a.toMutableJSON(e):null),_(this.ngZone),(0,P.t)(rt.bz))}insert(t){var e=this;return(0,c.A)(function*(){return e.collection.insert(t)})()}insertBulk(t){var e=this;return(0,c.A)(function*(){return e.collection.bulkInsert(t)})()}upsert(t){var e=this;return(0,c.A)(function*(){return e.collection.upsert(t)})()}upsertBulk(t){var e=this;return(0,c.A)(function*(){return e.collection.bulkUpsert(t)})()}set(t,e){var a=this;return(0,c.A)(function*(){return a.collection.findOne(t).update({$set:e})})()}updateBulk(t,e){var a=this;return(0,c.A)(function*(){return a.collection.find(t).update({$set:e})})()}remove(t){var e=this;return(0,c.A)(function*(){const a=Lt(t);return e.collection.findOne(a).remove()})()}removeBulk(t){var e=this;return(0,c.A)(function*(){return Array.isArray(t)?e.collection.bulkRemove(t):{success:[...(yield e.collection.find(t).remove().catch(()=>new Map)).values()],error:[]}})()}clear(){var t=this;return(0,c.A)(function*(){return t.collection.remove()})()}getAttachments(t){var e=this;return(0,c.A)(function*(){const a=yield e.collection.findOne(t).exec();if(!a)return null;const d=a.allAttachments().map(p=>p.getData());return Promise.all(d)})()}getAttachmentById(t,e){var a=this;return(0,c.A)(function*(){const d=yield a.collection.findOne(t).exec();if(!d)return null;const p=d.getAttachment(e);return p?p.getData():null})()}putAttachment(t,e){var a=this;return(0,c.A)(function*(){const d=yield a.collection.findOne(t).exec();d&&(yield d.putAttachment(e))})()}removeAttachment(t,e){var a=this;return(0,c.A)(function*(){const d=yield a.collection.findOne(t).exec();if(!d)return;const p=d.getAttachment(e);p&&(yield p.remove())})()}addHook(t,e){var a=this;return(0,c.A)(function*(d,p,R=!1){a.collection[d](p,R)}).apply(this,arguments)}getLocal(t,e){var a=this;return(0,c.A)(function*(){const d=yield a.collection.getLocal(t);return d?e?d?.get(e):d?.toJSON().data:null})()}getLocal$(t,e){return this.collection.getLocal$(t).pipe((0,b.T)(a=>a?e?a.get(e):a.toJSON().data:null),(0,ht.F)(),_(this.ngZone))}insertLocal(t,e){var a=this;return(0,c.A)(function*(){yield a.collection.insertLocal(t,e)})()}upsertLocal(t,e){var a=this;return(0,c.A)(function*(){yield a.collection.upsertLocal(t,e)})()}setLocal(t,e,a){var d=this;return(0,c.A)(function*(){const p=yield d.collection.getLocal(t);yield d.collection.upsertLocal(t,{...p?.toJSON?.()?.data||{},[e]:a})})()}removeLocal(t){var e=this;return(0,c.A)(function*(){yield(yield e.collection.getLocal(t))?.remove()})()}init(t){var e=this;return(0,c.A)(function*(){const{name:a,options:d}=t;try{yield e.dbService.initCollections({[a]:t}),e._collection=e.db.collections[a],d?.useQueryParams&&e.collection.queryParamsInit(e.currentUrl$,e.updateQueryParamsFn),e._init$.next(!0),e._init$.complete()}catch(p){if(!(p.message.includes("DM5")||p.message.includes("DB6")&&p.parameters.previousSchema?.version===p.parameters.schema?.version))throw e._init$.complete(),p;pt.log("Reload the page to fix the issue. The database is in a state where it can not be used."),yield(0,Y.A_)(e.db.name,e.db.storage),window?.location?.reload?.()}})()}}return(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"sync",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"info",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Array]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"import",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"export",null),(0,n.Cg)([U(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object,Object]),(0,n.Sn)("design:returntype",v.c)],i.prototype,"docs",null),(0,n.Cg)([U(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Array,Object]),(0,n.Sn)("design:returntype",v.c)],i.prototype,"docsByIds",null),(0,n.Cg)([U(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object]),(0,n.Sn)("design:returntype",v.c)],i.prototype,"count",null),(0,n.Cg)([U(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,Object]),(0,n.Sn)("design:returntype",v.c)],i.prototype,"get",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"insert",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Array]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"insertBulk",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"upsert",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Array]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"upsertBulk",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"set",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object,Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"updateBulk",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"remove",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"removeBulk",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"clear",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"getAttachments",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,String]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"getAttachmentById",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"putAttachment",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,String]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"removeAttachment",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",["function"==typeof(Ct=typeof Hook<"u"&&Hook)?Ct:Object,Object,Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"addHook",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,"function"==typeof(Dt=typeof K<"u"&&K)?Dt:Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"getLocal",null),(0,n.Cg)([U(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,"function"==typeof(Pt=typeof K<"u"&&K)?Pt:Object]),(0,n.Sn)("design:returntype",v.c)],i.prototype,"getLocal$",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,"function"==typeof(It=typeof L<"u"&&L)?It:Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"insertLocal",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,"function"==typeof(Mt=typeof L<"u"&&L)?Mt:Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"upsertLocal",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String,"function"==typeof(dt=typeof K<"u"&&K)?dt:Object,Object]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"setLocal",null),(0,n.Cg)([S(),(0,n.Sn)("design:type",Function),(0,n.Sn)("design:paramtypes",[String]),(0,n.Sn)("design:returntype",Promise)],i.prototype,"removeLocal",null),i})();var Bt=o(8651),Kt=o(2104);const{logger:r,getDefaultPreparedQuery:f}=C.lf,g="storage-token|storageToken",A=function(){var i=(0,c.A)(function*(s){let t;try{const a=yield(0,C.We)()(s);if(!a.ok)throw new Error(`Failed to fetch schema from "${s}", status: ${a.status}`);t=yield a.json()}catch{throw new Error(`Failed to fetch schema from "${s}"`)}return t});return function(t){return i.apply(this,arguments)}}(),ot=function(){var i=(0,c.A)(function*(s){try{const t={};for(const e in s){const a=s[e];!a.schema&&a.options?.schemaUrl&&(a.schema=yield A(a.options.schemaUrl)),t[a.name]=a}return t}catch(t){throw new Error(t.message)}});return function(t){return i.apply(this,arguments)}}(),ft=function(){var i=(0,c.A)(function*(s,t){let e;const d=yield(0,C.We)()(s);if(!d.ok)throw new Error(`Failed to fetch db dump from "${s}", status: ${d.status}`);if(e=yield d.json(),!t||!Object.keys(t).length)throw new Error("collections must be initialized before importing");for(const p of e.collections){const R=t[p.name];if(!R)throw new Error("no such collection as provided in dump");p.schemaHash=yield R.schema.hash}return e});return function(t,e){return i.apply(this,arguments)}}(),Qt=function(){var i=(0,c.A)(function*(s,t,e){let a={};if("dexie"!==s.name)return;const d=(yield t.internals)?.dexieTable;if(a=(yield d.get(g))?.data,!a?.rxdbVersion||(0,Bt.U)(e,a.rxdbVersion,">"))try{yield d.update(g,{data:{...a,rxdbVersion:e}}),r.log("prepare-plugin: migrated internal storage to",e)}catch{throw new Error("prepare-plugin: unable to migrate internal storage")}});return function(t,e,a){return i.apply(this,arguments)}}(),D={name:"prepare-plugin",rxdb:!0,prototypes:{RxDatabase:i=>{Object.assign(i,{fetchSchema:A})},RxCollection:i=>{Object.assign(i,{getMetadata:function(){var t=(0,c.A)(function*(){const e=yield(0,Y.NI)(this.database),a=yield(0,Kt.WY)(this.database.internalStore),{id:d,data:p,_meta:R,_rev:Et}=a.filter(gt=>gt.data.name===this.name).at(0)||{};return{id:d||this.name,databaseName:this.database.name,collectionName:p?.name||this.name,storageName:this.storageInstance.originalStorageInstance.storage.name,last_modified:R?.lwt?Math.floor(R?.lwt):Date.now(),rev:Et?Number(Et?.at(0)):1,isFirstTimeInstantiated:e}});return function(){return t.apply(this,arguments)}}()})}},hooks:{createRxDatabase:{after:function(){var i=(0,c.A)(function*({database:s,creator:t}){const e=yield(0,Y.NI)(s);r.log("prepare-plugin: hook:createRxDatabase:after");const{storage:a,internalStore:d,rxdbVersion:p}=s;if(yield Qt(a,d,p),t.options?.dumpPath&&e)try{const R=yield ft(t.options.dumpPath,s.collections);yield s.importJSON(R),r.log(`prepare-plugin: imported dump for db "${s.name}"`)}catch(R){r.log("prepare-plugin: imported dump error",R)}});return function(t){return i.apply(this,arguments)}}()},preCreateRxSchema:{before:function(){var i=(0,c.A)(function*(s){if("string"==typeof s){const t=yield A(s);if(!t)throw new Error(`Failed to fetch schema from "${s}"`);s=t}});return function(t){return i.apply(this,arguments)}}()},createRxCollection:{after:function(){var i=(0,c.A)(function*({collection:s,creator:t}){r.log("prepare-plugin: hook:createRxCollection:before");const e=yield s.getMetadata();r.log("prepare-plugin: hook:createRxCollection:before",e);const a=t.options?.initialDocs||[],d=yield J();if(!a.length)return;if(d||!e.isFirstTimeInstantiated){if(!t.options?.recreate||t.options?.replication)return;r.log(`prepare-plugin: collection "${s.name}" already has ${d} docs (including _deleted), but recreate option is set`)}const p=yield s.schema.hash,R={name:s.name,schemaHash:p,docs:a};try{const{success:F,error:zt}=yield s.importJSON(R),Ht=yield J();r.log(`prepare-plugin: imported ${F.length} docs for collection "${s.name}", errors count ${zt.length}, current docs count ${Ht}`),r.table(F)}catch(F){r.log("prepare-plugin: imported dump error",F)}return;function J(){return nt.apply(this,arguments)}function nt(){return(nt=(0,c.A)(function*(){const{count:F}=yield s.storageInstance.count(f()).catch(()=>({count:0}));return F})).apply(this,arguments)}});return function(t){return i.apply(this,arguments)}}()}}};var O=o(4281),M=o(4412),st=o(983),j=o(8141),q=o(9437),Z=o(8389),E=o(2573);const{keys:k,isEmpty:T,isNullOrUndefined:X}=C.lf,tt=(i,s)=>{i=E.A.extract(i);const t=E.A.pick(i,["selector","sort","limit","skip"]),e=E.A.parse(t,{parseNumbers:!0,parseBooleans:!0}),{selector:a,sort:d,limit:p,skip:R}=e;return(({selector:i,sort:s,limit:t,skip:e},a)=>{const d=k(a.jsonSchema.properties);return T(i)||(i=(0,Z.b)(i,p=>!p.startsWith("$")&&!p.includes(".")&&d.includes(p))),T(s)||(s=s?.filter(p=>d.includes(k(p)[0]))),(X(t)||isNaN(t))&&(t=void 0),(X(e)||isNaN(e))&&(e=void 0),{selector:i,sort:s,limit:t,skip:e}})({selector:a?JSON.parse(a):void 0,sort:d?JSON.parse(d):void 0,limit:p,skip:R},s)},et=i=>X(i)?"":JSON.stringify(i),{logger:ct,compactObject:Ot}=C.lf,B={name:"query-params-plugin",rxdb:!0,prototypes:{RxCollection:i=>{const s=new M.t({});let e,t=!1,a=!1,d="",p=()=>Promise.resolve(!1);Object.assign(i,{queryParams:{$:s.asObservable(),get:()=>s.getValue(),set:function Et(J){if(!t)return;const{selector:nt,sort:F,limit:zt,skip:Ht}=J,Vt={limit:zt,skip:Ht};nt&&(Vt.selector=et(J.selector)),F&&(Vt.sort=et(J.sort)),p(Vt)},patch:function gt(J){if(!t)return;const nt=tt(d,e),F={selector:et(J.selector||nt.selector),sort:et(J.sort||nt.sort),limit:J.limit||nt.limit,skip:J.skip||nt.skip};p(Ot(F))}}},{queryParamsInit:function R(J=st.w,nt){t=!!this.options?.useQueryParams,e=this.schema,t&&!a&&(p=nt,J.pipe((0,ht.F)(),(0,j.M)(F=>{d=F}),(0,b.T)(F=>tt(F,e)),(0,q.W)(F=>(ct.log("Error in parsing url to mango query",F),s)),(0,j.M)(F=>{ct.log("queryParams",F)}),(0,$.v)(()=>!this.closed)).subscribe(s),a=!0)}})}},hooks:{createRxCollection:{}}};var bt=o(1220),Ft=o(3803),x=o(6094),Nt=o(1384),w=o(5190);const{logger:V}=C.lf;function Rt(){return(Rt=(0,c.A)(function*(i=[]){try{(0,O.j)(x.$d),(0,O.j)(Ft.m),(0,O.j)(Nt.Qh),(0,O.j)(w.fg),(0,O.j)(bt.yQ),(0,O.j)(D),(0,O.j)(B);for(const s of i)(0,O.j)(s);V.log("rxdb plugins loaded")}catch(s){throw new Error(s.message??s)}})).apply(this,arguments)}const{logger:$t}=C.lf;class Jt{get db(){return this.dbInstance}get dbOptions(){return this.options}get collections(){return this.db.collections}destroyDb(){var s=this;return(0,c.A)(function*(){if(s.dbInstance)try{yield s.dbInstance.remove(),yield s.dbInstance.close()}catch(t){$t.log("database destroy error",t)}finally{s.dbInstance=null,$t.log("database instance destroyed")}})()}initDb(s){var t=this;return(0,c.A)(function*(){if(!t.dbInstance)try{if(yield function xt(){return Rt.apply(this,arguments)}(s.options?.plugins),t.dbInstance=yield(0,Y.uh)(s),t.options=s,$t.log(`created database "${t.db.name}" with config "${JSON.stringify(s)}"`),s?.options?.schemas){const e=yield t.initCollections(s.options.schemas);$t.log(`created ${Object.keys(e).length} collections bulk: ${Object.keys(e)}`)}}catch(e){throw $t.log("Error initializing the database:",e),e}})()}initCollections(s){var t=this;return(0,c.A)(function*(){try{const e=yield ot(s);return yield t.db.addCollections(e)}catch(e){throw $t.log("Error initializing collection(s)",e),e}})()}}var Gt=o(5984),Ut=o(3806);const Wt=new y.nKC("RxDBService Instance",{providedIn:"root",factory:()=>new Jt}),jt=new y.nKC("RxDatabaseCreator"),kt=new y.nKC("RxCollectionCreator"),wt=new y.nKC("RxDBCollectionService");function Xt(i){return[{provide:jt,useValue:i},(0,I.phd)(()=>function Zt(i,s){return(0,c.A)(function*(){yield i.initDb(s)})}((0,y.WQX)(Wt),(0,y.WQX)(jt))())]}function Yt(i){return[{provide:kt,useValue:i},{provide:wt,useFactory:(s,t,e,a,d)=>new St(s,t,e,a,d),deps:[kt,Wt,y.SKi,_t,qt]}]}const _t=new y.nKC("CURRENT_URL",{providedIn:"root",factory:()=>{const i=(0,y.WQX)(Gt.aZ),s=new M.t(window.location.href);return i.onUrlChange(t=>{s.next(t)}),(0,z.v)(()=>s).pipe((0,ht.F)())}}),qt=new y.nKC("UPDATE_QUERY_PARAMS",{providedIn:"root",factory:()=>{const i=(0,y.WQX)(Ut.Ix);return s=>i.navigate([],{queryParams:s,queryParamsHandling:"merge"})}});let te=(()=>{class i{static forFeature(t){return{ngModule:ee,providers:Yt(t)}}static forRoot(t){return{ngModule:i,providers:Xt(t)}}constructor(t,e,a,d){if(!a&&!e)throw new Error(`${jt.toString()} is not provided. Make sure you call the 'forRoot' method of the NgxRxdbModule in the AppModule only.`);if(a&&e)throw new Error(`${jt.toString()} is already provided. Make sure you call the 'forRoot' method of the NgxRxdbModule in the AppModule only.`);a&&!e&&t.donePromise.then(()=>{const p=d.get(Wt);p.db.startupErrors.length&&C.lf.logger.log(p.db.startupErrors),C.lf.logger.log(`database "${p.db.name}" ready, rxdb version is "${p.db.rxdbVersion}", storage is "${p.db.storage.name}"`)})}static{this.\u0275fac=function(e){return new(e||i)(y.KVO(I.H1s),y.KVO(jt,12),y.KVO(jt,10),y.KVO(y.zZn))}}static{this.\u0275mod=I.$C({type:i})}static{this.\u0275inj=y.G2t({})}}return i})(),ee=(()=>{class i{constructor(t,e){this.dbService=t,this.collectionService=e}static{this.\u0275fac=function(e){return new(e||i)(y.KVO(Wt),y.KVO(wt))}}static{this.\u0275mod=I.$C({type:i})}static{this.\u0275inj=y.G2t({})}}return i})()},7279(lt,it,o){o.d(it,{We:()=>W,bB:()=>mt,io:()=>Q,lf:()=>z,uR:()=>N});var z,c=o(6362),y=o(7042),I=o(9030),n=o(1584),C=o(6354),rt=o(2498),Y=o(5558);o(8141),function(l){function $(r){return Array.isArray(r)?r.slice():l.isObject(r)?{...r}:r}function G(r){let f=P(r);return Array.isArray(r)&&(f=f.filter(g=>"length"!==g)),f}function P(r){return r?Object.getOwnPropertyNames(r):[]}function ht(r,f){return H(P(r),g=>f(r[g],g)),r}function ut(r,f){return Array.isArray(r)?H(r,f):ht(r,f),r}function H(r,f){for(let g=0,A=r.length;g<A&&!1!==f(r[g],g);++g);}function yt(r){return Array.isArray(r)||(r=P(r)),0===r.length}function _(r){return null==r||"undefined"===r||"null"===r}function Ct(){}function Dt(r){return r}function Pt(r,f){const g=[];for(let A=0;A<r;++A)g[A]=f(A);return g}function dt(r){return r.filter(Dt)}function vt(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}l.clone=$,l.keys=G,l.keysOfNonArray=P,l.forOwn=function b(r,f){return H(G(r),g=>f(r[g],g)),r},l.forOwnOfNonArray=ht,l.forEach=ut,l.forEachOfArray=H,l.merge=function At(r,...f){for(const g of f)ut(g,(A,ot)=>{const ft=r[ot];ft instanceof Object&&(A=At($(ft),A)),r[ot]=A});return r},l.isEmpty=yt,l.isFunction=r=>"function"==typeof r,l.isUndefined=r=>void 0===r||"undefined"===r,l.isNullOrUndefined=_,l.isObject=r=>"[object Object]"===Object.prototype.toString.call(r),l.isEmptyObject=r=>_(r)||l.isObject(r)&&yt(r),l.isDevMode=function U(){return!1},l.isValidNumber=function S(r){return"number"==typeof r&&!isNaN(r)},l.noop=Ct,l.identity=Dt,l.times=Pt,l.range=function It(r,f,g){return l.isUndefined(f)&&(f=r,r=0),l.isUndefined(g)&&(g=f<r?-1:1),Pt(Math.abs((f-r)/(g||1)),A=>r+g*A)},l.getMaybeId=function Mt(r){return l.isObject(r)?r._id:String(r)},l.compact=dt,l.compactObject=function Lt(r){return yt(r)?r:Array.isArray(r)?dt(r):Object.entries(r).filter(([,f])=>!_(f)&&!yt(f)).reduce((f,[g,A])=>({...f,[g]:A}),{})},l.isDevModeForced=function pt(){return localStorage.debug?.includes("@ngx-odm/rxdb")},l.isTestEnvironment=vt,l.logger={log:(vt(),Ct),table:(vt(),Ct)},l.debug=function Tt(r="Event"){return function(g){return g}},l.retryWithBackoff=function St(r=3,f=1e4){return g=>g.pipe((0,rt.L)({count:r,delay:(A,ot)=>{const ft=Math.pow(2,ot-1)*f;return l.logger.log("replication:kinto:longpoll:retry",ot,ft),(0,n.O)(ft)}}))},l.tapOnce=r=>f=>(0,I.v)(()=>(r(),f)),l.deferUntil=r=>f=>(0,I.v)(()=>r.pipe((0,Y.n)(()=>f))),l.getDefaultQuery=()=>({selector:{_deleted:{$eq:!1}},skip:0,sort:[{id:"asc"}]});const Bt={properties:{id:{type:"string"},_deleted:{type:"boolean"}},primaryKey:"id",indexes:[["_deleted","id"]]};l.getDefaultQuery(),l.getDefaultPreparedQuery=()=>(0,c.Ib)(Bt,l.getDefaultQuery())}(z||(z={}));const W=()=>"object"==typeof window&&"fetch"in window?window.fetch.bind(window):fetch;function N(l={}){const $=W();return(P,b={})=>(Object.assign(b,{headers:{...b.headers||{},...l}}),$(P,b))}function Q(l){return l&&l instanceof y.Cs}function mt(l=!1){return(0,C.T)($=>(Array.isArray($)?$:[...$.values()]).map(G=>{const P=z.clone(G._data?G._data:G);return l||(delete P._rev,delete P._attachments,delete P._deleted,delete P._meta),P}))}},7566(lt,it,o){o.d(it,{WN:()=>g,cA:()=>St,mp:()=>Qt,YF:()=>y});var c=o(8173);const y=(0,c.hZ)("listAnimation",[(0,c.kY)("* <=> *",[(0,c.P)(":enter",[(0,c.iF)({opacity:0}),(0,c.yc)("50ms",(0,c.i0)("60ms ease-in",(0,c.iF)({opacity:1})))],{optional:!0}),(0,c.P)(":leave",(0,c.yc)("10ms",(0,c.i0)("50ms ease-out",(0,c.iF)({opacity:0}))),{optional:!0})])]);var I=o(467),n=o(6636);const C={isEqual:(u,m)=>(0,n.b)(u,m),resolve:u=>Promise.resolve(u.realMasterState)},rt={1:function(u){return u._deleted?null:(u.last_modified=new Date(u.createdAt).getTime(),u)},2:function(u){return u._deleted?null:(u.createdAt=new Date(u.createdAt).toISOString(),u)},3:u=>u},Y=[{id:"ac3ef2c6-c98b-43e1-9047-71d68b1f92f4",title:"Open Todo list example",completed:!0,createdAt:new Date(15463008e5).toISOString(),last_modified:15463008e5},{id:"a4c6a479-7cca-4d3b-ab90-45d3eaa957f3",title:"Check other examples",completed:!1,createdAt:new Date(15489792e5).toISOString(),last_modified:15489792e5},{id:"a4c6a479-7cca-4d3b-bc10-45d3eaa957r5",title:'Use "@ngx-odm/rxdb" in your project',completed:!1,createdAt:(new Date).toISOString(),last_modified:Date.now()}];var v=o(7279),z=o(4281),W=o(1239),N=o(7042),Q=o(1413),mt=o(983),l=o(7673),$=o(5558),G=o(6354),P=o(3207),b=o(2906),ht=o(7786),ut=o(6648),H=o(5964),At=o(605),yt=o(7048),_=function(u){return u.CLIENT_WINS="CLIENT_WINS",u.SERVER_WINS="SERVER_WINS",u.PULL_ONLY="PULL_ONLY",u.MANUAL="MANUAL",u}(_||{});const U={remote:"/",bucket:"default",collection:"default",headers:{},exclude:void 0,expectedTimestamp:void 0,timeout:void 0,heartbeat:6e4,strategy:_.CLIENT_WINS},S={kintoSyncOptions:U,live:!0,retryTime:5e3,waitForLeadership:!0,autoStart:!0};function dt(u,m){for(const h in m)u[h]=m[h];return u}function Lt({remote:u,bucket:m,collection:h,headers:D,exclude:O,expectedTimestamp:M}=U,st=(0,v.We)()){const j=`buckets/${m}/collections/${h}`;let q;return O&&(q={exclude_id:O.slice(0,50).map(E=>E.id).join(",")}),M&&(q={...q,_expected:M}),{info:()=>(0,I.A)(function*(){return(yield st(`${u}/${j}`,{headers:D})).json()})(),listRecords:Z=>(0,I.A)(function*(){const{...E}=Z;q&&(E.filters=q),E.sort||(E.sort="-last_modified");const k=function Dt(u,m={}){const h={...m.query};m.fields&&(h._fields=m.fields);const D=function It(u){const m=D=>encodeURIComponent("boolean"==typeof D?String(D):D),h=function Pt(u){const m={};for(const h in u)typeof u[h]<"u"&&(m[h]=u[h]);return m}(u);return Object.keys(h).map(D=>{const O=m("_"+D)+"=";return Array.isArray(h[D])?O+h[D].map(M=>m(M)).join(","):O+m(h[D])}).join("&")}(h);return D?u+"?"+D:u}(`${u}/${j}/records`,{query:E}),T=yield st(k,{headers:D}),X=T.headers.get("Next-Page"),at=T.headers.get("ETag"),tt=at&&at.replace(/"/g,""),{data:et}=yield T.json();return v.lf?.logger&&v.lf.logger.log("replication:kinto:since",T.status,tt),{data:et,hasNextPage:!!X,last_modified:tt}})(),batch:Z=>(0,I.A)(function*(){if(!Z.length)return{published:[],errors:[],conflicts:[],skipped:[],last_modified:void 0};const E=[],k=[],T=[];Z.forEach(B=>{B.deleted?E.push(B):B.last_modified?k.push(B):T.push(B)});const X={defaults:{headers:D},requests:[...T.map(({...B})=>({method:"PUT",path:`/${j}/records/${B.id}`,headers:{"If-None-Match":"*"},body:{data:B}})),...k.map(({last_modified:B,...bt})=>({method:"PATCH",path:`/${j}/records/${bt.id}`,headers:{"If-Match":`"${B}"`},body:{data:bt}})),...E.map(({id:B})=>({method:"DELETE",path:`/${j}/records/${B}`}))]},at=JSON.stringify(X),tt=yield st(`${u}/batch`,{headers:D,method:"POST",body:at});v.lf?.logger&&v.lf.logger.log("replication:kinto:batch",tt.status);const{responses:et,requests:ct}=yield tt.json();return function Mt(u=[],m=[]){if(u.length!==m.length)throw new Error("Responses length should match requests one.");return u.reduce((O,M,st)=>{const{status:j,headers:q}=M,Z=q?.ETag;O.last_modified=Z?+Z.replace(/"/g,""):void 0;const E=m[st];if(j>=200&&j<400)O.published.push(M.body);else if(404===j){const T=E.path.match(/(buckets|groups|collections|records)\/([^/]+)$/);O.skipped.push({id:T&&3===T.length?T[2]:void 0,path:E.path,error:M.body})}else 412===j?O.conflicts.push({type:"outgoing",local:E.body,remote:M.body.details&&M.body.details.existing||null}):O.errors.push({path:E.path,sent:E,error:M.body});return O},{errors:[],published:[],conflicts:[],skipped:[],last_modified:void 0})}(et,ct||X.requests)})()}}var vt=o(7369),Tt=o(3465);const St={production:!0,baseUrl:"/api/v1",kintoServer:"https://demo.kinto-storage.org/v1/",bucket:"default",collection:"todos",couchDbRemote:"localhost:5983",couchDbSyncLive:!0,couchDbSyncHeartbeat:60};function r(){return(r=(0,I.A)(function*(){const u=yield this.find().exec();return u.filter(m=>!!m.completed).length/u.length})).apply(this,arguments)}const f={percentageCompleted:function Kt(){return r.apply(this,arguments)}},g={name:"todo",localDocuments:!0,schema:void 0,options:{schemaUrl:"assets/data/todo.schema.json",initialDocs:Y,useQueryParams:"true"===localStorage._ngx_rxdb_queryparams,replicationStateFactory:u=>{let m=null;switch(localStorage._ngx_rxdb_replication){case"kinto":m=function pt(u){const{replicationIdentifier:m,kintoSyncOptions:h,fetch:D,pull:O,push:M,collection:st,retryTime:j,live:q,autoStart:Z}=Object.assign(S,u);(0,z.j)(W.g9);const k=Lt(h,D),T=new Q.B;let X,at,et,tt=mt.w;O&&(X={handler:(Ot,B)=>(0,I.A)(function*(){et=Ot?.last_modified||void 0;const bt=B||void 0;return tt=(0,l.of)(null).pipe((0,$.n)(()=>k.listRecords({since:et,limit:bt})),(0,G.T)(({data:Ft,last_modified:x})=>(et=x,{documents:Ft,checkpoint:{last_modified:x}}))),(0,P.s)(tt.pipe((0,b.$)(),v.lf.retryWithBackoff(1,j)))})(),batchSize:O?.batchSize,modifier:O?.modifier,stream$:T.asObservable()}),M&&(at={handler:Ot=>(0,I.A)(function*(){yield st.getMetadata();const{data:{last_modified:bt}}=yield k.info(),Ft=Ot.map(({newDocumentState:w})=>w),x={errors:[],published:[],conflicts:[],skipped:[],last_modified:bt};if(dt(x,yield k.batch(Ft)),x.errors.length&&v.lf.logger.log(x.errors),x.skipped.length){const w=x.skipped.filter(({error:V})=>404==V.code).map(({path:V})=>{const xt=Ft.find(Rt=>String(V).endsWith(Rt.id));return xt&&delete xt.last_modified,xt});w.length&&dt(x,yield k.batch(w))}if(x.conflicts.length){const w=x.conflicts.filter(({remote:V})=>!V).map(V=>(delete V.local.data.last_modified,V.local.data));w.length&&dt(x,yield k.batch(w))}return x.published.length?x.published.filter(({data:w})=>!w.deleted).map(({data:w})=>w):x.conflicts.map(w=>w.remote)})(),batchSize:M?.batchSize,modifier:M?.modifier});const ct=new N.Cs(m,st,"deleted",X,at,q,j,Z);return q&&O&&(0,ht.h)((0,ut.H)(ct.awaitInitialReplication()),ct.remoteEvents$.pipe((0,H.p)(Ot=>"RESYNC"===Ot))).pipe((0,$.n)(()=>(0,At.Y)(O.heartbeat||6e4)),(0,$.n)(()=>tt),v.lf.debug("replication:kinto:longpoll"),v.lf.retryWithBackoff(3,j),(0,yt.v)(()=>!ct.isStopped())).subscribe(T),(0,N.Jc)(!0,ct),ct}({replicationIdentifier:"demo-kinto-replication:todo",collection:u,kintoSyncOptions:{remote:St.kintoServer,bucket:St.bucket,collection:St.collection},fetch:(0,v.uR)({Authorization:"Basic "+(0,vt.Ir)("admin:adminadmin")}),retryTime:15e3,live:!0,autoStart:!0,pull:{batchSize:60,modifier:h=>h,heartbeat:6e4},push:{modifier:h=>h}});break;case"couchdb":m=(0,Tt.SA)({replicationIdentifier:"demo-couchdb-replication",collection:u,fetch:(0,v.uR)({Authorization:"Basic "+(0,vt.Ir)("admin:adminadmin")}),url:"http://localhost:5984/demo/",retryTime:15e3,live:!0,pull:{batchSize:60,modifier:h=>h,heartbeat:6e4},push:{modifier:h=>h}})}return m}},statics:f,migrationStrategies:rt,conflictHandler:C};var ot=o(375),ft=o(4800);function Qt(){return{provide:ot.zcH,useFactory:()=>{const u=(0,ot.WQX)(ot.zZn);return{handleError:m=>{const h=u.get(ft.tG);h&&"DB6"===m.code?(console.warn("[DB_ERROR_HANDLER] Database schema has changed. Destroying database and reloading page..."),h.destroyDb().then(()=>{window.location.reload()})):console.error(m)}}}}}},7782(lt,it,o){o.d(it,{_N:()=>Y,gB:()=>C});var c=o(7279),y=o(5020),I=o(1176),n=o(9455);function C(v){let{name:z,options:W,storage:N,...Q}=v;return N||(N="dexie"===W.storageType?(0,y.N)(W.storageOptions):(0,I.HJ)(W.storageOptions)),c.lf.isDevMode()&&(N=(0,n.Os)({storage:N})),{name:z,storage:N,options:W,...Q}}const Y="local"}},lt=>{lt.O(0,[502],()=>lt(lt.s=3112)),lt.O()}]);